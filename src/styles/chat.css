.chat-panel { flex:1; display:flex; flex-direction:column; background:var(--color-bg-primary); height:100vh; }
.chat-panel-empty { align-items:center; justify-content:center; }
.chat-panel-placeholder { text-align:center; color:var(--color-text-secondary); max-width:340px; }
.chat-panel-placeholder h3 { font-size:22px; font-weight:600; color:var(--color-text-primary); margin-bottom:8px; }
.chat-header-new { padding:16px 24px; border-bottom:1px solid var(--color-border); display:flex; align-items:center; justify-content:space-between; background:var(--color-bg-primary); }
.chat-header-left { display:flex; align-items:center; gap:14px; }
.chat-header-avatar { width:44px; height:44px; font-size:17px; }
.chat-contact-name { margin:0 0 2px; font-size:16px; font-weight:600; color:var(--color-text-primary); }
.chat-contact-status { font-size:12px; color:var(--color-text-muted); }
.chat-contact-status.status-online { color:#22c55e; }
.chat-contact-status.status-away { color:#f59e0b; }
.chat-contact-status.status-busy { color:#ef4444; }
.chat-messages-wrapper { flex:1; overflow:hidden; }
/* Lista de mensajes: quitamos gap para poder controlar agrupaciones dinámicas */
.chat-messages-list { height:100%; overflow-y:auto; padding:20px 24px; display:flex; flex-direction:column; gap:0; }
/* Ancho base */
.chat-msg { max-width:70%; margin-top:12px; position:relative; }
/* Primer mensaje sin margen superior */
.chat-messages-list > .chat-msg:first-child { margin-top:0; }
/* Limitar ancho máximo absoluto y evitar que textos extremadamente largos rompan el layout */
.chat-msg { max-width: min(70%, 640px); }
.chat-msg-bubble { max-width:100%; word-break:break-word; overflow-wrap:anywhere; }
.chat-msg-bubble p { word-break:break-word; overflow-wrap:anywhere; }
@media (min-width:1400px){
  .chat-msg { max-width:min(55%, 720px); }
}
/* Mensajes propios a la derecha */
.chat-msg.own { align-self:flex-end; }

/* Agrupación: si dos seguidos del mismo lado, reducimos separación */
.chat-msg.own + .chat-msg.own { margin-top:4px; }
.chat-msg:not(.own) + .chat-msg:not(.own) { margin-top:4px; }

/* Burbujas base */
.chat-msg-bubble { background:var(--color-bg-secondary); padding:10px 14px 18px; border-radius:20px; position:relative; box-shadow:0 2px 4px rgba(0,0,0,0.06); border:1px solid rgba(0,0,0,0.04); backdrop-filter:blur(2px); }

/* Estilo burbuja propia con gradiente */
.chat-msg.own .chat-msg-bubble { background:linear-gradient(135deg,#6366f1 0%, #8b5cf6 100%); color:#fff; border:1px solid rgba(255,255,255,0.18); box-shadow:0 4px 12px -4px rgba(99,102,241,0.5); }

/* Afinar radios cuando se agrupan (fusionar lado de conexión) */
.chat-msg.own + .chat-msg.own .chat-msg-bubble { border-top-right-radius:8px; }
.chat-msg:not(.own) + .chat-msg:not(.own) .chat-msg-bubble { border-top-left-radius:8px; }

/* Tails (esquinas triangulares suaves) */
.chat-msg-bubble::after { content:""; position:absolute; bottom:0; width:12px; height:12px; background:inherit; }
.chat-msg:not(.own) .chat-msg-bubble::after { left:-4px; border-bottom-right-radius:10px; transform:translateY(-2px) rotate(12deg); box-shadow:0 2px 4px rgba(0,0,0,0.05); }
.chat-msg.own .chat-msg-bubble::after { right:-4px; border-bottom-left-radius:10px; transform:translateY(-2px) rotate(-12deg); box-shadow:0 2px 4px rgba(0,0,0,0.18); }

/* Ajustar tail al agrupar (no repetir) */
.chat-msg:not(.own) + .chat-msg:not(.own) .chat-msg-bubble::after,
.chat-msg.own + .chat-msg.own .chat-msg-bubble::after { display:none; }
/* Texto y tiempo */
.chat-msg-bubble p { margin:0 0 4px; font-size:14px; line-height:1.45; }
.chat-msg-time { font-size:11px; opacity:.65; display:block; text-align:right; margin-top:4px; transition:opacity .25s ease; }
.chat-msg.own .chat-msg-time { color:rgba(255,255,255,.9); }

/* Acciones sobre el mensaje */
.chat-msg-actions { position:absolute; left:10px; bottom:4px; display:flex; gap:6px; opacity:1; transform:none; }
.chat-msg-action { background:transparent; border:none; width:22px; height:22px; display:flex; align-items:center; justify-content:center; border-radius:6px; cursor:pointer; padding:0; color:#fff; transition:color .2s ease, opacity .2s ease; opacity:.85; }
.chat-msg:not(.own) .chat-msg-action { color:var(--color-text-secondary); }
.chat-msg-action:hover { opacity:1; color:#fff; }
.chat-msg:not(.own) .chat-msg-action:hover { color:var(--color-text-primary); }
.chat-msg-action:focus-visible { outline:2px solid var(--color-primary); outline-offset:2px; }
/* Animación confirmación copia */
@keyframes copiedPulse {
  0% { transform:scale(1) rotate(0deg); filter:brightness(1); }
  20% { transform:scale(1.35) rotate(8deg); filter:brightness(1.25); }
  45% { transform:scale(0.9) rotate(-4deg); }
  70% { transform:scale(1.05) rotate(2deg); }
  100% { transform:scale(1) rotate(0deg); filter:brightness(1); }
}
.chat-msg-action.copied-anim { animation: copiedPulse .55s cubic-bezier(.55,.1,.25,1); }

/* Estado de copiado */
.chat-msg-bubble.copied { outline:2px solid rgba(16,185,129,.6); box-shadow:0 0 0 3px rgba(16,185,129,.25); }
.chat-msg-bubble.reminder-added { animation: reminderGlow 1.1s ease; }
@keyframes reminderGlow { 0%{box-shadow:0 0 0 0 rgba(234,179,8,.0);} 35%{box-shadow:0 0 0 6px rgba(234,179,8,.35);} 70%{box-shadow:0 0 0 2px rgba(234,179,8,.15);} 100%{box-shadow:0 0 0 0 rgba(234,179,8,.0);} }

/* Animación botón descarga */
.chat-msg-action.downloading-anim { animation: downloadPulse .65s cubic-bezier(.55,.1,.25,1); position:relative; }
@keyframes downloadPulse { 0%{transform:scale(1); filter:brightness(1);} 30%{transform:scale(1.35) rotate(-8deg); filter:brightness(1.25);} 55%{transform:scale(.9) rotate(5deg);} 80%{transform:scale(1.08);} 100%{transform:scale(1); filter:brightness(1);} }
.chat-msg-action.downloading-anim::after { content:""; position:absolute; inset:-4px; border-radius:10px; background:radial-gradient(circle at center, rgba(99,102,241,.35), rgba(99,102,241,0)); opacity:.9; animation: downloadWave .65s ease; pointer-events:none; }
@keyframes downloadWave { 0%{transform:scale(.4); opacity:.8;} 60%{transform:scale(1); opacity:.2;} 100%{transform:scale(1.4); opacity:0;} }

/* Tarjeta de archivo rediseñada */
.chat-file-card { display:flex; gap:14px; align-items:flex-start; }
.chat-file-icon-wrap { position:relative; width:48px; height:54px; border-radius:14px; background:linear-gradient(135deg,#6366f1,#8b5cf6); display:flex; align-items:center; justify-content:center; color:#fff; box-shadow:0 4px 10px -2px rgba(99,102,241,.5); flex-shrink:0; }
.chat-msg:not(.own) .chat-file-icon-wrap { background:linear-gradient(135deg,#f5f5f5,#e5e7eb); color:var(--color-primary); box-shadow:0 4px 10px -2px rgba(0,0,0,.15); }
/* Eliminado badge superpuesto de extensión sobre el icono */
.chat-file-info { flex:1; min-width:0; display:flex; flex-direction:column; gap:4px; }
.chat-file-name { font-size:13px; font-weight:600; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; max-width:260px; }
.chat-file-meta-line { display:flex; align-items:center; gap:6px; font-size:11px; font-weight:500; opacity:.75; flex-wrap:wrap; }
.chat-file-size { font-weight:600; }
.chat-file-ext-badge { font-size:10px; padding:3px 8px 3px; border-radius:10px; background:rgba(255,255,255,.25); letter-spacing:.5px; font-weight:600; backdrop-filter:blur(3px); }
.chat-msg:not(.own) .chat-file-ext-badge { background:rgba(99,102,241,.12); color:var(--color-primary); }
.chat-file-dot { width:4px; height:4px; background:currentColor; border-radius:50%; opacity:.5; }

/* Vista previa origen recordatorio reutiliza estilos existentes de dialog */
.reminder-msg-preview { margin:0; font-size:13px; line-height:1.4; background:var(--color-bg-tertiary); border:1px solid var(--color-border); padding:10px 12px; border-radius:14px; max-height:90px; overflow:auto; }

/* Mensajes archivo dentro de burbuja estilizada */
.chat-msg-bubble.file { padding:10px 14px 16px; }
.chat-msg-bubble.file .chat-file { display:flex; align-items:center; gap:10px; }
.chat-msg-bubble.file .chat-file-icon { width:34px; height:34px; border-radius:12px; display:flex; align-items:center; justify-content:center; background:rgba(255,255,255,0.15); backdrop-filter:blur(2px); color:#fff; }
.chat-msg:not(.own) .chat-msg-bubble.file .chat-file-icon { background:linear-gradient(135deg,#6366f1 0%, #8b5cf6 100%); color:#fff; }
.chat-file-name { font-size:13px; }
.chat-file-size { font-size:11px; opacity:.7; }
.chat-input-bar { display:flex; gap:12px; padding:12px 20px 20px; border-top:1px solid var(--color-border); background:var(--color-bg-primary); }
.chat-textarea { flex:1; resize:none; border:1px solid var(--color-border); background:var(--color-bg-secondary); padding:10px 12px; border-radius:12px; font-size:14px; line-height:1.4; color:var(--color-text-primary); max-height:180px; overflow-y:hidden; }

/* Nuevo contenedor estilo ChatGPT */
.chat-input-container-new {
  padding: 20px;
  background: var(--color-bg-primary);
  display: flex;
  justify-content: center;
}

.chat-input-wrapper-new {
  width: 100%;
  max-width: 768px;
  background: var(--color-bg-secondary);
  border: 1px solid var(--color-border);
  border-radius: 24px;
  display: flex;
  align-items: flex-end;
  padding: 8px 12px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
  transition: border-color 0.2s ease, box-shadow 0.2s ease;
}

.chat-input-wrapper-new:focus-within {
  border-color: var(--color-primary);
  box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1), 0 2px 8px rgba(0, 0, 0, 0.08);
}

.chat-textarea-new {
  flex: 1;
  border: none;
  outline: none;
  background: transparent;
  resize: none;
  font-size: 16px;
  line-height: 1.5;
  color: var(--color-text-primary);
  padding: 10px 12px;
  min-height: 44px;
  max-height: 200px;
  overflow-y: hidden;
  font-family: inherit;
  scrollbar-width: thin;
  scrollbar-color: var(--color-text-muted) transparent;
}

.chat-textarea-new::placeholder {
  color: var(--color-text-muted);
}

.chat-textarea-new::-webkit-scrollbar {
  width: 6px;
}

.chat-textarea-new::-webkit-scrollbar-track {
  background: transparent;
}

.chat-textarea-new::-webkit-scrollbar-thumb {
  background: var(--color-text-muted);
  border-radius: 3px;
}

.chat-textarea-new::-webkit-scrollbar-thumb:hover {
  background: var(--color-text-secondary);
}

.chat-send-btn-new {
  margin-left: 10px;
  margin-bottom: 8px;
  width: 38px;
  height: 38px;
  border: none;
  background: transparent;
  color: var(--color-text-secondary);
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: color .25s ease, transform .25s ease;
  flex-shrink: 0;
  line-height: 1;
  font-size: 22px;
  padding:0;
}
.chat-send-btn-new svg { display:block; width:22px; height:22px; }
.chat-send-btn-new:hover:not(:disabled) { color: var(--color-text-primary); }
.chat-send-btn-new:active:not(:disabled) { transform: scale(.9); }
.chat-send-btn-new:disabled { opacity:.45; cursor:not-allowed; }
.chat-input-wrapper-new:focus-within .chat-send-btn-new:not(:disabled) { color: var(--color-primary); }

/* Nuevo botón enviar circular estilo ChatGPT */
.chat-send-circle {
  margin-left:8px;
  margin-bottom:8px;
  width:42px;
  height:42px;
  border-radius:50%;
  border:1px solid var(--color-border);
  background:var(--color-bg-primary);
  display:flex;
  align-items:center;
  justify-content:center;
  color:var(--color-text-secondary);
  cursor:pointer;
  transition:background .25s ease, color .25s ease, border-color .25s ease, transform .25s ease;
  flex-shrink:0;
  padding:0;
}
.chat-send-circle svg { display:block; }
.chat-send-circle:hover:not(:disabled) { background:var(--color-bg-tertiary); color:var(--color-text-primary); }
.chat-send-circle:active:not(:disabled) { transform:scale(.9); }
.chat-send-circle:disabled { opacity:.45; cursor:not-allowed; }
.chat-send-circle.ready { border-color:var(--color-primary); color:var(--color-primary); }
.chat-input-wrapper-new:focus-within .chat-send-circle.ready { background:var(--color-primary); color:#fff; }

/* Ajustar textarea para alinear verticalmente con botones de 42px */
.chat-textarea-new { padding-top:12px; padding-bottom:12px; }

/* === Emoji Picker === */
.emoji-toggle-btn {
  background:var(--color-bg-primary);
  border:1px solid var(--color-border);
  width:42px;
  height:42px;
  border-radius:14px;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  transition:.2s;
  flex-shrink:0;
  color:var(--color-text-secondary);
  margin-left:4px;
}
.emoji-toggle-btn:hover { background:var(--color-bg-tertiary); color:var(--color-text-primary); }
.emoji-toggle-btn.active { border-color:var(--color-primary); box-shadow:0 0 0 2px rgba(99,102,241,.25); color:var(--color-primary); }
.chat-input-wrapper-has-plus { position:relative; }
.emoji-popover { position:absolute; bottom:60px; left:8px; z-index:40; animation:fadeIn .18s ease; }
.emoji-panel { background:var(--color-bg-secondary); border:1px solid var(--color-border); border-radius:20px; padding:14px 14px 10px; width:340px; max-height:360px; display:flex; flex-direction:column; gap:12px; box-shadow:0 18px 48px -12px rgba(0,0,0,.35), 0 4px 16px rgba(0,0,0,.15); }
.emoji-group { display:flex; flex-direction:column; gap:6px; }
.emoji-group-label { font-size:11px; font-weight:600; text-transform:uppercase; letter-spacing:.7px; color:var(--color-text-secondary); padding:0 4px; }
.emoji-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(40px,1fr)); gap:6px; }
.emoji-btn { background:var(--color-bg-primary); border:1px solid var(--color-border); border-radius:14px; height:40px; font-size:20px; display:flex; align-items:center; justify-content:center; cursor:pointer; transition:.18s; }
.emoji-btn:hover { background:var(--color-bg-tertiary); transform:translateY(-2px); box-shadow:0 4px 10px rgba(0,0,0,.08); }
.emoji-hint { font-size:11px; text-align:center; opacity:.65; padding-top:4px; }

@media (max-width:600px){
  .emoji-popover { left:12px; right:12px; width:auto; }
  .emoji-panel { width:100%; }
}
.chat-textarea:focus { outline:2px solid var(--color-primary); outline-offset:2px; }
.chat-send-btn { background:linear-gradient(135deg,var(--color-primary) 0%,#8b5cf6 100%); border:none; color:#fff; font-weight:600; padding:0 20px; border-radius:12px; cursor:pointer; transition:.25s; }
.chat-send-btn:disabled { opacity:.5; cursor:not-allowed; }
.chat-send-btn:not(:disabled):hover { filter:brightness(1.1); transform:translateY(-2px); box-shadow:0 4px 14px rgba(99,102,241,.35); }

/* ---- ChatArea (nueva versión) input ---- */
.chat-input-container { background:var(--color-bg-primary); }
.chat-input-form { display:flex; align-items:flex-end; gap:8px; padding:10px 14px; }
.chat-input-button { 
  width:40px; 
  height:40px; 
  border-radius:50%; 
  display:flex; 
  align-items:center; 
  justify-content:center; 
  color:var(--color-text-secondary); 
  transition:var(--transition);
  border:none;
  background:transparent;
  cursor:pointer;
  padding:0;
  line-height:1;
}
.chat-input-button:hover { background:var(--color-bg-tertiary); color:var(--color-text-primary); }
.chat-input-button--plain { width:auto; height:auto; border-radius:0; padding:4px 6px; background:transparent; }
.chat-input-button--plain:hover { background:transparent; color:var(--color-text-primary); }
.chat-input-wrapper { flex:1; position:relative; display:flex; align-items:flex-end; gap:6px; background:var(--color-bg-secondary); border:1px solid var(--color-border); border-radius:18px; padding:6px 10px 6px 44px; }
.chat-input-plus { position:absolute; left:10px; top:50%; transform:translateY(-50%); color:var(--color-text-secondary); font-size:26px; line-height:1; display:flex; align-items:center; justify-content:center; cursor:pointer; padding:2px; }
.chat-input-plus:hover { color:var(--color-text-primary); }
.chat-input { flex:1; resize:none; background:transparent; font-size:14px; line-height:1.4; max-height:180px; /* coincide con MAX_TEXTAREA_HEIGHT */ overflow-y:hidden; }
.chat-send-button { background:var(--color-primary); color:#fff; border-radius:14px; padding:0 16px; height:40px; display:flex; align-items:center; justify-content:center; gap:4px; font-weight:500; }
.chat-send-button:disabled { opacity:.5; cursor:not-allowed; }
.chat-send-button:not(:disabled):hover { filter:brightness(1.1); }

/* === Botón + y menú de acciones === */
.chat-plus-btn {
  background:var(--color-bg-primary);
  border:1px solid var(--color-border);
  width:42px;
  height:42px;
  border-radius:14px;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  transition:.2s;
  flex-shrink:0;
  color:var(--color-text-secondary);
  margin-left:4px;
  font-size:24px;
  line-height:1;
  font-weight:500;
  padding:0;
}
.chat-plus-btn:hover { background:var(--color-bg-tertiary); color:var(--color-text-primary); }
.chat-plus-btn.active { border-color:var(--color-primary); box-shadow:0 0 0 2px rgba(99,102,241,.25); color:var(--color-primary); }

/* Posiciona el contenedor que aloja el status-menu reutilizado */
.chat-actions-popover { position:absolute; bottom:62px; left:10px; z-index:55; }

/* Botones antiguos ya no usados (referencias apuntan a .status-menu-item) */

.chat-action-ico { font-size:20px; width:24px; text-align:center; }
.chat-action-label { flex:1; }

@media (max-width:600px){ .chat-actions-popover { left:12px; right:12px; } }

/* Botón + inline (sin contenedor voluminoso) */
.chat-plus-inline {
  position:absolute; left:14px; bottom:8px; top:auto; /* posición fija al fondo */
  width:42px; height:42px;
  border-radius:50%;
  background:var(--color-bg-primary);
  border:1px solid var(--color-border);
  color:var(--color-text-secondary);
  font-size:28px; line-height:1;
  display:flex; align-items:center; justify-content:center;
  cursor:pointer; transition:background .25s ease, color .25s ease, border-color .25s ease, transform .25s ease; padding:0; font-weight:500;
}
.chat-plus-inline:hover { background:var(--color-bg-tertiary); color:var(--color-text-primary); }
.chat-plus-inline:active { transform:scale(.9); }
.chat-plus-inline.active { border-color:var(--color-primary); color:var(--color-primary); }

/* Añadir espacio interno cuando hay + absoluto */
/* Ajustes de padding para nuevo tamaño (42px) del botón + */
.chat-input-wrapper-has-plus .chat-textarea-new { padding-left:76px; padding-bottom:14px; }

/* Iconos fijos (adjuntos + emoji) dentro del input */
/* Eliminados estilos fijos: se vuelve al botón inline minimalista sin fondo */
.fixed-inline { position:absolute; bottom:10px; top:auto; transform:none; background:transparent; border:none; width:30px; height:30px; }
.fixed-inline:hover { background:transparent; }
.fixed-inline.active { color:var(--color-primary); }
.chat-plus-inline.fixed-inline { left:14px; }

/* Ajustar pill para no tapar iconos */
/* Reposicionar pill para no superponer botón + ampliado */
.attachment-pill { top:10px; left:76px; max-width:56%; }
.chat-input-wrapper-new.has-attachment { padding-top:56px; }

/* Previsualización de archivo adjunto pendiente */
.chat-input-wrapper-new.has-attachment { padding-top:60px; }
@keyframes pillIn { from { transform:translateY(4px); opacity:0;} to { transform:translateY(0); opacity:1;} }
.attachment-pill { position:absolute; left:14px; top:8px; display:flex; align-items:center; gap:10px; background:var(--color-bg-secondary); border:1px solid var(--color-border); border-radius:14px; padding:8px 14px 8px 10px; max-width:62%; box-shadow:0 2px 8px rgba(0,0,0,.12); animation:pillIn .25s cubic-bezier(.4,0,.2,1); cursor:pointer; }
.attachment-pill:hover { background:var(--color-bg-tertiary); }
.ap-icon { width:34px; height:34px; border-radius:10px; display:flex; align-items:center; justify-content:center; color:#fff; font-size:14px; flex-shrink:0; box-shadow:0 2px 6px rgba(0,0,0,.3); }
.ap-info { flex:1; min-width:0; display:flex; flex-direction:column; line-height:1.1; }
.ap-name { font-size:13px; font-weight:600; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.ap-meta { font-size:11px; font-weight:500; color:var(--color-text-secondary); }
.ap-remove { background:var(--color-bg-primary); border:1px solid var(--color-border); width:22px; height:22px; border-radius:50%; display:flex; align-items:center; justify-content:center; cursor:pointer; font-size:14px; line-height:1; color:var(--color-text-secondary); transition:.18s; flex-shrink:0; }
.ap-remove:hover { background:var(--color-bg-tertiary); color:var(--color-text-primary); }
.ap-remove:active { transform:scale(.85); }
.chat-file-caption { margin:10px 0 0; font-size:13px; line-height:1.4; font-style:italic; opacity:.85; }

/* Ajustes del picker de emojis para integrarlo visualmente */
.emoji-popover .EmojiPickerReact {
  --epr-bg-color: var(--color-bg-secondary);
  --epr-category-label-bg-color: var(--color-bg-secondary);
  --epr-picker-border-color: var(--color-border);
  background: var(--color-bg-secondary) !important;
  border:1px solid var(--color-border) !important;
  box-shadow:0 18px 48px -12px rgba(0,0,0,.35), 0 4px 16px rgba(0,0,0,.15);
  border-radius:20px !important;
  padding-top:6px;
}
.emoji-popover .EmojiPickerReact .epr-emoji-category-label { font-size:11px; letter-spacing:.6px; }
.emoji-popover .EmojiPickerReact .epr-body { padding-bottom:8px; }
